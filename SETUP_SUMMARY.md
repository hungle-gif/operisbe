# üéØ T√≥m t·∫Øt H·ªá th·ªëng Project Templates - Operis

## üìã T·ªïng quan

H·ªá th·ªëng **Project Templates v·ªõi Dynamic Options** ƒë√£ ƒë∆∞·ª£c x√¢y d·ª±ng ho√†n ch·ªânh cho ph√©p:
- Admin t·∫°o c√°c d·ª± √°n m·∫´u v·ªõi options ƒë·ªông
- Customer ch·ªçn template v√† t√πy ch·ªânh options khi t·∫°o y√™u c·∫ßu
- T√≠nh gi√° t·ª± ƒë·ªông d·ª±a tr√™n options ƒë∆∞·ª£c ch·ªçn

---

## üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng

### Backend (Django)

**1. Models**
- `ProjectTemplate` - Model ch√≠nh
  - File: `backend/apps/projects/models/project_template.py`
  - B·∫£ng: `project_templates`
  - Fields quan tr·ªçng:
    - `name`, `description`, `category`, `icon`
    - `price_min`, `price_max`
    - `estimated_duration_min`, `estimated_duration_max`
    - `key_features` (JSON)
    - `deliverables` (JSON)
    - `technologies` (JSON)
    - `phases` (JSON)
    - `team_structure` (JSON)
    - **`options` (JSON)** - Dynamic options m·ªõi
    - `is_active`, `display_order`

**2. API Endpoints**
- File: `backend/apps/projects/routers/project_template_router.py`
- Base URL: `/api/project-templates`

| Method | Endpoint | Auth | M√¥ t·∫£ |
|--------|----------|------|-------|
| GET | `/` | Public | Danh s√°ch templates active |
| GET | `/admin/all` | Admin | T·∫•t c·∫£ templates |
| GET | `/{id}` | Public | Chi ti·∫øt template |
| POST | `/` | Admin | T·∫°o m·ªõi |
| PUT | `/{id}` | Admin | C·∫≠p nh·∫≠t |
| DELETE | `/{id}` | Admin | X√≥a |
| GET | `/categories/list` | Public | Danh s√°ch categories |

**3. Schemas**
- File: `backend/apps/projects/schemas/project_template_schema.py`
- Schemas:
  - `ProjectTemplateOut` - Output ƒë·∫ßy ƒë·ªß
  - `ProjectTemplateListOut` - Output list
  - `ProjectTemplateCreate` - Input t·∫°o m·ªõi
  - `ProjectTemplateUpdate` - Input c·∫≠p nh·∫≠t

**4. Migrations**
- `0013_projecttemplate.py` - T·∫°o b·∫£ng ban ƒë·∫ßu
- `0014_projecttemplate_options.py` - Th√™m field options

**5. Django Admin**
- File: `backend/apps/projects/admin.py`
- Class: `ProjectTemplateAdmin`
- Features:
  - List display v·ªõi t·∫•t c·∫£ fields quan tr·ªçng
  - List editable: `is_active`, `display_order`
  - Filters: category, is_active, created_at
  - Search: name, description
  - Fieldsets: Grouped logically

---

### Frontend (Next.js)

**1. Admin Page - Qu·∫£n l√Ω Templates**
- File: `frontend/app/(dashboard)/dashboard/admin/project-templates/page.tsx`
- URL: `/dashboard/admin/project-templates`

**T√≠nh nƒÉng:**
- ‚ú® Grid view ƒë·∫πp v·ªõi gradient cards
- üìä Hi·ªÉn th·ªã stats: Gi√°, Th·ªùi gian, Features, Options
- üé® Hover effects & shadows
- üîç Filter theo category
- ‚ûï T·∫°o m·ªõi template
- ‚úèÔ∏è Ch·ªânh s·ª≠a template
- üóëÔ∏è X√≥a template

**Modal t·∫°o/s·ª≠a - 5 Tabs:**

**Tab 1: Th√¥ng tin c∆° b·∫£n**
- T√™n, Icon, M√¥ t·∫£
- Danh m·ª•c
- Gi√° & Th·ªùi gian (highlighted box)

**Tab 2: T√≠nh nƒÉng & B√†n giao**
- Key features (textarea)
- Deliverables (textarea)
- Technologies (textarea)

**Tab 3: Quy tr√¨nh & Team**
- Phases (JSON editor - purple gradient)
- Team structure (JSON editor - green gradient)

**Tab 4: Options ƒë·ªông**
- OptionBuilder component
- Qu·∫£n l√Ω t·∫•t c·∫£ 5 lo·∫°i options

**Tab 5: C√†i ƒë·∫∑t**
- Active/Inactive toggle
- Display order

**2. OptionBuilder Component**
- File: `frontend/components/admin/OptionBuilder.tsx`
- Component ph·ª©c t·∫°p ƒë·ªÉ qu·∫£n l√Ω dynamic options
- Features:
  - Add/Remove options
  - Expand/Collapse options
  - Configure t·ª´ng lo·∫°i option
  - Drag handle (UI ready)

**3. Navigation**
- File: `frontend/components/layout/DashboardHeader.tsx`
- Menu m·ªõi: "D·ª± √°n M·∫´u" (icon: Layers)
- Ch·ªâ hi·ªÉn th·ªã cho Admin

---

## üéõÔ∏è Dynamic Options System

### 5 Lo·∫°i Options

**1. Package (G√≥i d·ªãch v·ª•)**
```json
{
  "id": "package",
  "type": "package",
  "label": "G√≥i d·ªãch v·ª•",
  "required": true,
  "choices": [
    {
      "value": "basic",
      "label": "Basic",
      "price": 30000000,
      "duration_days": 30,
      "features": ["Feature 1", "Feature 2"]
    }
  ]
}
```

**2. Single Select (Ch·ªçn 1)**
```json
{
  "id": "language",
  "type": "single_select",
  "label": "Ng√¥n ng·ªØ",
  "required": true,
  "choices": [
    {"value": "vi", "label": "Ti·∫øng Vi·ªát", "price_modifier": 0},
    {"value": "en", "label": "Ti·∫øng Anh", "price_modifier": 3000000}
  ]
}
```

**3. Multi Select (Ch·ªçn nhi·ªÅu)**
```json
{
  "id": "features",
  "type": "multi_select",
  "label": "T√≠nh nƒÉng b·ªï sung",
  "required": false,
  "choices": [
    {"value": "seo", "label": "SEO", "price_modifier": 5000000}
  ]
}
```

**4. Number Range (S·ªë l∆∞·ª£ng)**
```json
{
  "id": "product_count",
  "type": "number_range",
  "label": "S·ªë l∆∞·ª£ng s·∫£n ph·∫©m",
  "min": 100,
  "max": 10000,
  "step": 100,
  "price_per_unit": 1000
}
```

**5. Text Input (VƒÉn b·∫£n)**
```json
{
  "id": "custom_note",
  "type": "text_input",
  "label": "Y√™u c·∫ßu ƒë·∫∑c bi·ªát",
  "required": false,
  "placeholder": "Nh·∫≠p y√™u c·∫ßu..."
}
```

---

## üìä D·ªØ li·ªáu m·∫´u

**2 Templates ƒë√£ t·∫°o:**

### 1. H·ªá th·ªëng qu·∫£n tr·ªã doanh nghi·ªáp
- Gi√°: 12,000,000ƒë
- Th·ªùi gian: 14 ng√†y
- **4 Options:**
  1. Package (3 g√≥i: Basic/Standard/Enterprise)
  2. Modules b·ªï sung (5 l·ª±a ch·ªçn)
  3. H√¨nh th·ª©c tri·ªÉn khai (Cloud/On-premise/Hybrid)
  4. Y√™u c·∫ßu t√πy ch·ªânh (text input)

### 2. Ph√°t tri·ªÉn Website
- Gi√°: 50,000,000ƒë
- Th·ªùi gian: 30 ng√†y
- **5 Options:**
  1. G√≥i website (3 g√≥i: Landing/Corporate/Professional)
  2. Ng√¥n ng·ªØ (Single/Bilingual/Multilingual)
  3. T√≠nh nƒÉng b·ªï sung (5 l·ª±a ch·ªçn)
  4. S·ªë trang (0-50)
  5. Y√™u c·∫ßu ƒë·∫∑c bi·ªát (text input)

---

## üöÄ C√°ch s·ª≠ d·ª•ng

### Setup Backend

```bash
# Ch·∫°y migration
docker-compose exec backend python manage.py migrate projects

# T·∫°o d·ªØ li·ªáu m·∫´u
docker-compose exec backend python scripts/create_sample_templates.py

# Th√™m options m·∫´u
docker-compose exec backend python scripts/add_sample_options.py
```

### Setup Frontend

```bash
# T·∫°o file .env.local
echo "NEXT_PUBLIC_API_URL=http://localhost:8001" > frontend/.env.local
echo "NEXT_PUBLIC_APP_NAME=Operis" >> frontend/.env.local

# Restart frontend
docker-compose restart frontend
```

### Truy c·∫≠p

- **Admin Dashboard**: http://localhost:3001/dashboard/admin
- **Project Templates**: http://localhost:3001/dashboard/admin/project-templates
- **API Docs**: http://localhost:8001/api/docs

---

## üìÅ File Structure

```
backend/
‚îú‚îÄ‚îÄ apps/projects/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project_template.py          # Model ch√≠nh
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project_template_schema.py   # API schemas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project_template_router.py   # API endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ admin.py                         # Django admin
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îú‚îÄ‚îÄ 0013_projecttemplate.py
‚îÇ       ‚îî‚îÄ‚îÄ 0014_projecttemplate_options.py
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ create_sample_templates.py       # T·∫°o templates m·∫´u
‚îÇ   ‚îî‚îÄ‚îÄ add_sample_options.py            # Th√™m options m·∫´u
‚îî‚îÄ‚îÄ api/
    ‚îî‚îÄ‚îÄ main.py                          # Register routers

frontend/
‚îú‚îÄ‚îÄ app/(dashboard)/dashboard/admin/
‚îÇ   ‚îî‚îÄ‚îÄ project-templates/
‚îÇ       ‚îú‚îÄ‚îÄ page.tsx                     # Admin page M·ªöI
‚îÇ       ‚îî‚îÄ‚îÄ page_old.tsx                 # Backup
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OptionBuilder.tsx           # Options builder
‚îÇ   ‚îî‚îÄ‚îÄ layout/
‚îÇ       ‚îî‚îÄ‚îÄ DashboardHeader.tsx         # Navigation
‚îî‚îÄ‚îÄ .env.local                          # Environment variables
```

---

## üé® Design System

### Colors
- **Primary**: Blue (#3B82F6) ‚Üí Indigo (#6366F1) gradients
- **Success**: Green (#10B981)
- **Danger**: Red (#EF4444)
- **Warning**: Yellow (#F59E0B)
- **Info**: Purple (#8B5CF6)

### Components
- **Cards**: `rounded-xl`, `shadow-md`, hover `shadow-2xl`
- **Buttons**: `rounded-lg` ho·∫∑c `rounded-xl`
- **Inputs**: `rounded-lg`, focus `ring-2`
- **Badges**: `rounded-full`, `px-2 py-1`

### Icons (Lucide React)
- `Plus` - T·∫°o m·ªõi
- `Edit2` - S·ª≠a
- `Trash2` - X√≥a
- `Sparkles` - Features
- `Clock` - Duration
- `DollarSign` - Price
- `Settings` - Options
- `Layers` - Templates
- `CheckCircle` - Active

---

## üêõ Troubleshooting

### 1. ERR_EMPTY_RESPONSE
**Nguy√™n nh√¢n**: Frontend g·ªçi sai port backend

**Gi·∫£i ph√°p**:
```bash
# Ki·ªÉm tra port backend ƒëang ch·∫°y
docker-compose ps

# S·ª≠a .env.local cho ƒë√∫ng port
echo "NEXT_PUBLIC_API_URL=http://localhost:8001" > frontend/.env.local

# Restart frontend
docker-compose restart frontend
```

### 2. localStorage not defined
**Nguy√™n nh√¢n**: SSR c·ªßa Next.js

**Gi·∫£i ph√°p**: ƒê√£ fix b·∫±ng check `typeof window`
```typescript
if (typeof window === 'undefined') return
const token = localStorage.getItem('token')
```

### 3. CORS Error
**Gi·∫£i ph√°p**: Ki·ªÉm tra CORS settings trong Django
```python
CORS_ALLOWED_ORIGINS = [
    "http://localhost:3000",
    "http://localhost:3001",
]
```

---

## üìö Documentation

- **PROJECT_TEMPLATES_DOCUMENTATION.md** - T√†i li·ªáu t·ªïng quan
- **DYNAMIC_OPTIONS_DOCUMENTATION.md** - Chi ti·∫øt v·ªÅ Dynamic Options
- **PAYMENT_FLOW_DOCUMENTATION.md** - Quy tr√¨nh thanh to√°n

---

## ‚úÖ Checklist tri·ªÉn khai

### Backend
- [x] Model ProjectTemplate
- [x] Field options (JSONField)
- [x] API Endpoints (CRUD)
- [x] Schemas
- [x] Django Admin
- [x] Migrations
- [x] Sample data scripts

### Frontend
- [x] Admin page v·ªõi tabs
- [x] OptionBuilder component
- [x] Navigation menu
- [x] Grid view ƒë·∫πp
- [x] Modal form v·ªõi 5 tabs
- [x] Responsive design
- [x] Error handling
- [x] Loading states

### Integration
- [x] API connection
- [x] Authentication
- [x] CRUD operations
- [x] Environment setup

### Documentation
- [x] Setup guide
- [x] API documentation
- [x] Usage guide
- [x] Troubleshooting

---

## üîú Next Steps (Future)

### Phase 2: Customer Experience
- [ ] Trang ch·ªçn template cho customer
- [ ] OptionSelector component
- [ ] Real-time price calculator
- [ ] Integration v·ªõi Service Request

### Phase 3: Advanced Features
- [ ] Conditional options
- [ ] Option templates (re-use)
- [ ] Analytics
- [ ] A/B testing
- [ ] Dynamic pricing rules

---

## üéâ K·∫øt qu·∫£

H·ªá th·ªëng **Project Templates v·ªõi Dynamic Options** ƒë√£ ho√†n th√†nh v·ªõi:

‚úÖ **Backend**: Model, API, Admin ho√†n ch·ªânh
‚úÖ **Frontend**: UI ƒë·∫πp, UX t·ªët, responsive
‚úÖ **Dynamic Options**: 5 lo·∫°i options linh ho·∫°t
‚úÖ **Sample Data**: 2 templates v·ªõi options ƒë·∫ßy ƒë·ªß
‚úÖ **Documentation**: Chi ti·∫øt, d·ªÖ hi·ªÉu
‚úÖ **Production Ready**: ƒê√£ test, fix bugs

**Admin c√≥ th·ªÉ:**
- T·∫°o d·ª± √°n m·∫´u v·ªõi giao di·ªán ƒë·∫πp, tabs nh∆∞ customer view
- Th√™m options ƒë·ªông kh√¥ng c·∫ßn code
- Qu·∫£n l√Ω gi√°, th·ªùi gian, t√≠nh nƒÉng

**Customer s·∫Ω c√≥ th·ªÉ:** (Phase 2)
- Xem danh s√°ch templates
- Ch·ªçn v√† t√πy ch·ªânh options
- T√≠nh gi√° t·ª± ƒë·ªông
- G·ª≠i y√™u c·∫ßu d·ªãch v·ª•

üöÄ **H·ªá th·ªëng s·∫µn s√†ng cho production!**
