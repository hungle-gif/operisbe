# Project Templates - Qu·∫£n l√Ω D·ª± √°n M·∫´u

## T·ªïng quan

T√≠nh nƒÉng **Project Templates** (D·ª± √°n M·∫´u) cho ph√©p Admin t·∫°o v√† qu·∫£n l√Ω c√°c d·ª± √°n m·∫´u ƒë·ªãnh s·∫µn m√† kh√°ch h√†ng c√≥ th·ªÉ ch·ªçn khi t·∫°o y√™u c·∫ßu d·ªãch v·ª•. ƒêi·ªÅu n√†y gi√∫p:

- Ti√™u chu·∫©n h√≥a c√°c lo·∫°i d·ª± √°n ph·ªï bi·∫øn
- Hi·ªÉn th·ªã th√¥ng tin gi√°, th·ªùi gian, t√≠nh nƒÉng m·ªôt c√°ch r√µ r√†ng
- Gi√∫p kh√°ch h√†ng d·ªÖ d√†ng ch·ªçn l·ª±a d·ªãch v·ª• ph√π h·ª£p
- TƒÉng t·ªëc ƒë·ªô b√°o gi√° v√† b·∫Øt ƒë·∫ßu d·ª± √°n

## Ki·∫øn tr√∫c

### 1. Backend Components

#### Model: `ProjectTemplate`
ƒê∆∞·ªùng d·∫´n: `backend/apps/projects/models/project_template.py`

**C√°c tr∆∞·ªùng ch√≠nh:**

```python
class ProjectTemplate(BaseModel):
    # Th√¥ng tin c∆° b·∫£n
    name: str                           # T√™n d·ª± √°n m·∫´u
    description: str                    # M√¥ t·∫£ chi ti·∫øt
    category: str                       # Danh m·ª•c (choices)
    icon: str                          # Icon/emoji hi·ªÉn th·ªã

    # Gi√° & Th·ªùi gian
    price_min: Decimal                 # Gi√° t·ªëi thi·ªÉu (VNƒê)
    price_max: Decimal | None          # Gi√° t·ªëi ƒëa (None = "Li√™n h·ªá")
    estimated_duration_min: int        # Th·ªùi gian t·ªëi thi·ªÉu (ng√†y)
    estimated_duration_max: int | None # Th·ªùi gian t·ªëi ƒëa

    # Chi ti·∫øt d·ª± √°n (JSON fields)
    key_features: list[str]            # Danh s√°ch t√≠nh nƒÉng ch√≠nh
    deliverables: list[str]            # S·∫£n ph·∫©m b√†n giao
    technologies: list[str]            # C√¥ng ngh·ªá s·ª≠ d·ª•ng
    phases: list[dict]                 # C√°c giai ƒëo·∫°n th·ª±c hi·ªán
    team_structure: dict               # C·∫•u tr√∫c team

    # Tr·∫°ng th√°i
    is_active: bool                    # C√≥ hi·ªÉn th·ªã cho customer kh√¥ng
    display_order: int                 # Th·ª© t·ª± hi·ªÉn th·ªã
```

**Danh m·ª•c (Categories):**

- `web_development` - Ph√°t tri·ªÉn Website
- `mobile_app` - ·ª®ng d·ª•ng Mobile
- `enterprise_system` - H·ªá th·ªëng Doanh nghi·ªáp
- `ecommerce` - Th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠
- `crm_system` - H·ªá th·ªëng CRM
- `erp_system` - H·ªá th·ªëng ERP
- `ai_ml` - AI & Machine Learning
- `consulting` - T∆∞ v·∫•n
- `maintenance` - B·∫£o tr√¨ & H·ªó tr·ª£

#### API Endpoints

**Base URL:** `/api/project-templates`

| Method | Endpoint | Auth | M√¥ t·∫£ |
|--------|----------|------|-------|
| GET | `/` | Public | L·∫•y danh s√°ch templates active (cho customer) |
| GET | `/admin/all` | Admin | L·∫•y t·∫•t c·∫£ templates (bao g·ªìm inactive) |
| GET | `/{id}` | Public | L·∫•y chi ti·∫øt 1 template |
| POST | `/` | Admin | T·∫°o template m·ªõi |
| PUT | `/{id}` | Admin | C·∫≠p nh·∫≠t template |
| DELETE | `/{id}` | Admin | X√≥a template |
| GET | `/categories/list` | Public | L·∫•y danh s√°ch categories |

**Query Parameters:**

- `category` (string) - L·ªçc theo danh m·ª•c
- `is_active` (boolean) - L·ªçc theo tr·∫°ng th√°i (m·∫∑c ƒë·ªãnh: true)

**Example Request:**

```bash
# L·∫•y t·∫•t c·∫£ templates active
curl http://localhost:8000/api/project-templates/

# L·ªçc theo category
curl http://localhost:8000/api/project-templates/?category=web_development

# Admin: L·∫•y t·∫•t c·∫£ (bao g·ªìm inactive)
curl -H "Authorization: Bearer <token>" \
  http://localhost:8000/api/project-templates/admin/all
```

**Example Response:**

```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "X√¢y d·ª±ng h·ªá th·ªëng qu·∫£n tr·ªã doanh nghi·ªáp th√¥ng minh t√πy bi·∫øn",
    "description": "Gi·∫£i ph√°p qu·∫£n tr·ªã doanh nghi·ªáp to√†n di·ªán...",
    "category": "enterprise_system",
    "icon": "üè¢",
    "price_min": 12000000,
    "price_max": null,
    "estimated_duration_min": 14,
    "estimated_duration_max": null,
    "key_features": [
      "Qu·∫£n l√Ω nh√¢n s·ª± v√† ch·∫•m c√¥ng",
      "Qu·∫£n l√Ω d·ª± √°n v√† c√¥ng vi·ªác",
      "..."
    ],
    "deliverables": ["M√£ ngu·ªìn ƒë·∫ßy ƒë·ªß", "..."],
    "technologies": ["React/Next.js", "Django/Python", "..."],
    "phases": [...],
    "team_structure": {...},
    "is_active": true,
    "display_order": 1,
    "created_at": "2025-10-20T10:00:00Z",
    "updated_at": "2025-10-20T10:00:00Z"
  }
]
```

### 2. Frontend Components

#### Admin Page: Qu·∫£n l√Ω D·ª± √°n M·∫´u
ƒê∆∞·ªùng d·∫´n: `frontend/app/(dashboard)/dashboard/admin/project-templates/page.tsx`

**URL:** `/dashboard/admin/project-templates`

**T√≠nh nƒÉng:**

1. **Danh s√°ch Templates (Grid View)**
   - Hi·ªÉn th·ªã d·∫°ng card v·ªõi th√¥ng tin:
     - Icon, t√™n, danh m·ª•c
     - Gi√° v√† th·ªùi gian d·ª± ki·∫øn
     - T√≠nh nƒÉng ch√≠nh (3 ƒë·∫ßu ti√™n)
     - Tr·∫°ng th√°i (Active/Inactive)
   - Filter theo danh m·ª•c
   - S·∫Øp x·∫øp theo `display_order`

2. **Modal T·∫°o/Ch·ªânh s·ª≠a Template**
   - Form ƒë·∫ßy ƒë·ªß v·ªõi validation
   - C√°c section:
     - Th√¥ng tin c∆° b·∫£n (t√™n, m√¥ t·∫£, danh m·ª•c, icon)
     - Gi√° & Th·ªùi gian
     - T√≠nh nƒÉng ch√≠nh (textarea, m·ªói d√≤ng 1 t√≠nh nƒÉng)
     - Tr·∫°ng th√°i & Th·ª© t·ª± hi·ªÉn th·ªã

3. **H√†nh ƒë·ªông (Actions)**
   - Ch·ªânh s·ª≠a template
   - X√≥a template (c√≥ confirm)

#### Navigation Menu
Menu "D·ª± √°n M·∫´u" ƒë√£ ƒë∆∞·ª£c th√™m v√†o Admin navigation:
- Icon: Layers
- V·ªã tr√≠: Sau menu "D·ª± √°n", tr∆∞·ªõc menu "D·ªãch v·ª•"

### 3. Database Migration

**Migration file:** `apps/projects/migrations/0013_projecttemplate.py`

T·∫°o b·∫£ng `project_templates` v·ªõi t·∫•t c·∫£ c√°c tr∆∞·ªùng c·∫ßn thi·∫øt.

**Ch·∫°y migration:**

```bash
# T·∫°o migration
docker-compose exec backend python manage.py makemigrations projects

# Ch·∫°y migration
docker-compose exec backend python manage.py migrate projects
```

## H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng

### A. D√†nh cho Admin

#### 1. T·∫°o D·ª± √°n M·∫´u M·ªõi

1. ƒêƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n Admin
2. V√†o menu **"D·ª± √°n M·∫´u"** tr√™n header
3. Click n√∫t **"+ T·∫°o D·ª± √Ån M·∫´u M·ªõi"**
4. ƒêi·ªÅn th√¥ng tin:
   - **T√™n d·ª± √°n m·∫´u** *: V√≠ d·ª• "X√¢y d·ª±ng h·ªá th·ªëng qu·∫£n tr·ªã doanh nghi·ªáp"
   - **M√¥ t·∫£** *: M√¥ t·∫£ chi ti·∫øt v·ªÅ d·ª± √°n
   - **Danh m·ª•c** *: Ch·ªçn t·ª´ dropdown
   - **Icon**: Nh·∫≠p emoji (üè¢, üåê, üì±, etc.)
   - **Gi√° t·ªëi thi·ªÉu (VNƒê)** *: V√≠ d·ª• 12000000
   - **Gi√° t·ªëi ƒëa**: ƒê·ªÉ tr·ªëng n·∫øu mu·ªën hi·ªÉn th·ªã "Li√™n h·ªá"
   - **Th·ªùi gian t·ªëi thi·ªÉu (ng√†y)** *: V√≠ d·ª• 14
   - **Th·ªùi gian t·ªëi ƒëa**: ƒê·ªÉ tr·ªëng ho·∫∑c nh·∫≠p s·ªë ng√†y
   - **T√≠nh nƒÉng ch√≠nh**: M·ªói d√≤ng m·ªôt t√≠nh nƒÉng
   - **K√≠ch ho·∫°t**: Check ƒë·ªÉ hi·ªÉn th·ªã cho kh√°ch h√†ng
   - **Th·ª© t·ª± hi·ªÉn th·ªã**: S·ªë c√†ng nh·ªè c√†ng ∆∞u ti√™n
5. Click **"T·∫°o m·ªõi"**

#### 2. Ch·ªânh s·ª≠a D·ª± √°n M·∫´u

1. Trong danh s√°ch, click n√∫t **"Ch·ªânh s·ª≠a"** tr√™n card template
2. C·∫≠p nh·∫≠t th√¥ng tin c·∫ßn thi·∫øt
3. Click **"C·∫≠p nh·∫≠t"**

#### 3. X√≥a D·ª± √°n M·∫´u

1. Click n√∫t **"X√≥a"** tr√™n card template
2. X√°c nh·∫≠n trong dialog
3. Template s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn

#### 4. L·ªçc v√† T√¨m ki·∫øm

- S·ª≠ d·ª•ng dropdown **"Danh m·ª•c"** ƒë·ªÉ l·ªçc theo category
- Ch·ªçn "T·∫•t c·∫£" ƒë·ªÉ hi·ªÉn th·ªã to√†n b·ªô

#### 5. Qu·∫£n l√Ω qua Django Admin

Ngo√†i giao di·ªán frontend, Admin c≈©ng c√≥ th·ªÉ qu·∫£n l√Ω qua Django Admin:

```
URL: http://localhost:8000/admin/projects/projecttemplate/
```

T√≠nh nƒÉng:
- List display: name, category, price_min, price_max, duration, is_active, display_order
- List editable: is_active, display_order (ch·ªânh s·ª≠a nhanh)
- Filters: category, is_active, created_at
- Search: name, description
- Fieldsets ƒë∆∞·ª£c nh√≥m r√µ r√†ng

### B. D√†nh cho Developer

#### 1. T·∫°o Template qua Code

```python
from apps.projects.models import ProjectTemplate, ProjectTemplateCategory
from decimal import Decimal

template = ProjectTemplate.objects.create(
    name="Ph√°t tri·ªÉn Mobile App",
    description="·ª®ng d·ª•ng mobile ƒëa n·ªÅn t·∫£ng v·ªõi React Native",
    category=ProjectTemplateCategory.MOBILE_APP,
    icon="üì±",
    price_min=Decimal('30000000'),
    price_max=Decimal('80000000'),
    estimated_duration_min=30,
    estimated_duration_max=60,
    key_features=[
        "iOS & Android",
        "Push Notifications",
        "In-app Purchases"
    ],
    deliverables=[
        "Source code",
        "App Store deployment",
        "Documentation"
    ],
    technologies=["React Native", "Firebase", "Redux"],
    phases=[
        {
            "name": "Design",
            "duration_days": 10,
            "percentage": 20,
            "description": "UI/UX Design"
        }
    ],
    team_structure={
        "project_manager": 1,
        "developers": 2,
        "designers": 1
    },
    is_active=True,
    display_order=3
)
```

#### 2. Query Templates

```python
# L·∫•y t·∫•t c·∫£ active templates
active_templates = ProjectTemplate.objects.filter(is_active=True)

# L·ªçc theo category
web_templates = ProjectTemplate.objects.filter(
    category=ProjectTemplateCategory.WEB_DEVELOPMENT,
    is_active=True
).order_by('display_order')

# L·∫•y template theo ID
template = ProjectTemplate.objects.get(id=template_id)

# S·ª≠ d·ª•ng helper methods
price_display = template.get_price_display()  # "12,000,000ƒë - 50,000,000ƒë"
duration_display = template.get_duration_display()  # "14 - 30 ng√†y"
```

#### 3. API Integration

**Frontend (Next.js):**

```typescript
// Fetch templates
const fetchTemplates = async () => {
  const response = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/project-templates/`
  )
  const data = await response.json()
  return data
}

// Create template (Admin only)
const createTemplate = async (templateData) => {
  const response = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/project-templates/`,
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(templateData)
    }
  )
  return response.json()
}

// Update template (Admin only)
const updateTemplate = async (id, templateData) => {
  const response = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/project-templates/${id}`,
    {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(templateData)
    }
  )
  return response.json()
}

// Delete template (Admin only)
const deleteTemplate = async (id) => {
  const response = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/project-templates/${id}`,
    {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    }
  )
  return response.json()
}
```

## Sample Data

Script t·∫°o d·ªØ li·ªáu m·∫´u: `backend/scripts/create_sample_templates.py`

**Ch·∫°y script:**

```bash
docker-compose exec backend python scripts/create_sample_templates.py
```

**Templates m·∫´u ƒë√£ t·∫°o:**

1. **X√¢y d·ª±ng h·ªá th·ªëng qu·∫£n tr·ªã doanh nghi·ªáp th√¥ng minh t√πy bi·∫øn**
   - Danh m·ª•c: H·ªá th·ªëng Doanh nghi·ªáp
   - Gi√°: 12,000,000ƒë
   - Th·ªùi gian: 14 ng√†y
   - Chi ph√≠ TB: 12,000,000ƒë

2. **Ph√°t tri·ªÉn Website**
   - Danh m·ª•c: Ph√°t tri·ªÉn Website
   - Gi√°: 50,000,000ƒë
   - Th·ªùi gian: 30 ng√†y
   - Chi ph√≠ TB: 50,000,000ƒë

## T√≠ch h·ª£p v·ªõi Service Request Flow (T∆∞∆°ng lai)

Trong t∆∞∆°ng lai, Project Templates c√≥ th·ªÉ ƒë∆∞·ª£c t√≠ch h·ª£p v√†o form t·∫°o Service Request:

1. Customer xem danh s√°ch templates
2. Ch·ªçn template ph√π h·ª£p
3. Form t·∫°o y√™u c·∫ßu t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin t·ª´ template
4. Customer c√≥ th·ªÉ t√πy ch·ªânh th√™m y√™u c·∫ßu ri√™ng
5. H·ªá th·ªëng t·∫°o Service Request v√† Project d·ª±a tr√™n template

**C√°c b∆∞·ªõc tri·ªÉn khai:**

1. Th√™m field `template_id` v√†o `ServiceRequest` model
2. C·∫≠p nh·∫≠t form t·∫°o y√™u c·∫ßu ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch templates
3. Auto-fill form data t·ª´ template khi customer ch·ªçn
4. Service t·ª± ƒë·ªông s·ª≠ d·ª•ng template ƒë·ªÉ t·∫°o Proposal

## Ki·ªÉm th·ª≠

### Manual Testing Checklist

#### Backend API
- [ ] GET `/api/project-templates/` tr·∫£ v·ªÅ danh s√°ch templates active
- [ ] GET `/api/project-templates/?category=web_development` filter ƒë√∫ng
- [ ] GET `/api/project-templates/{id}` tr·∫£ v·ªÅ chi ti·∫øt template
- [ ] POST `/api/project-templates/` (Admin) t·∫°o template m·ªõi
- [ ] PUT `/api/project-templates/{id}` (Admin) c·∫≠p nh·∫≠t template
- [ ] DELETE `/api/project-templates/{id}` (Admin) x√≥a template
- [ ] GET `/api/project-templates/categories/list` tr·∫£ v·ªÅ danh s√°ch categories
- [ ] Auth: Endpoint admin b·ªã ch·∫∑n n·∫øu kh√¥ng c√≥ token/kh√¥ng ph·∫£i admin

#### Frontend
- [ ] Trang `/dashboard/admin/project-templates` hi·ªÉn th·ªã danh s√°ch
- [ ] Filter theo category ho·∫°t ƒë·ªông
- [ ] Click "T·∫°o m·ªõi" m·ªü modal v·ªõi form tr·ªëng
- [ ] Submit form t·∫°o template m·ªõi th√†nh c√¥ng
- [ ] Click "Ch·ªânh s·ª≠a" m·ªü modal v·ªõi data ƒë√£ c√≥
- [ ] Submit form c·∫≠p nh·∫≠t template th√†nh c√¥ng
- [ ] Click "X√≥a" hi·ªÉn th·ªã confirm v√† x√≥a ƒë∆∞·ª£c
- [ ] Menu "D·ª± √°n M·∫´u" hi·ªÉn th·ªã trong header Admin
- [ ] Responsive tr√™n mobile

#### Django Admin
- [ ] Truy c·∫≠p `/admin/projects/projecttemplate/` ƒë∆∞·ª£c
- [ ] List display hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng
- [ ] C√≥ th·ªÉ edit inline `is_active` v√† `display_order`
- [ ] Search ho·∫°t ƒë·ªông
- [ ] Filter ho·∫°t ƒë·ªông

### Automated Tests (TODO)

```python
# tests/test_project_templates.py
class ProjectTemplateAPITestCase(TestCase):
    def test_list_active_templates(self):
        # Test GET /api/project-templates/
        pass

    def test_create_template_admin_only(self):
        # Test POST requires admin auth
        pass

    def test_filter_by_category(self):
        # Test category filtering
        pass
```

## Troubleshooting

### L·ªói th∆∞·ªùng g·∫∑p

1. **Migration error**
   ```
   Gi·∫£i ph√°p: X√≥a migration v√† t·∫°o l·∫°i
   docker-compose exec backend python manage.py migrate projects zero
   docker-compose exec backend python manage.py migrate projects
   ```

2. **API 404 Not Found**
   ```
   Ki·ªÉm tra: Router ƒë√£ ƒë∆∞·ª£c register trong api/main.py ch∆∞a
   Ki·ªÉm tra: Backend container c√≥ ƒëang ch·∫°y kh√¥ng
   ```

3. **Frontend kh√¥ng load ƒë∆∞·ª£c templates**
   ```
   Ki·ªÉm tra: NEXT_PUBLIC_API_URL trong .env
   Ki·ªÉm tra: CORS settings trong backend
   Ki·ªÉm tra: Network tab trong browser DevTools
   ```

4. **Permission denied khi t·∫°o/s·ª≠a/x√≥a**
   ```
   Ki·ªÉm tra: User c√≥ role='admin' kh√¥ng
   Ki·ªÉm tra: Token h·ª£p l·ªá v√† ch∆∞a expire
   ```

## K·∫øt lu·∫≠n

T√≠nh nƒÉng Project Templates ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai ƒë·∫ßy ƒë·ªß v·ªõi:

‚úÖ Backend model, API, schemas, routers
‚úÖ Database migration
‚úÖ Django Admin integration
‚úÖ Frontend admin page (create, read, update, delete)
‚úÖ Navigation menu integration
‚úÖ Sample data script
‚úÖ Comprehensive documentation

**C√°c b∆∞·ªõc ti·∫øp theo ƒë·ªÅ xu·∫•t:**

1. T√≠ch h·ª£p templates v√†o Service Request flow
2. Th√™m preview template cho customer
3. Th√™m analytics (templates n√†o ƒë∆∞·ª£c ch·ªçn nhi·ªÅu nh·∫•t)
4. Th√™m versioning cho templates
5. Import/Export templates (JSON, Excel)
